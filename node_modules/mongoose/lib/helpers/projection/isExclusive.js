'use strict';

const isDefiningProjection = require('./isDefiningProjection');
<<<<<<< HEAD
const isPOJO = require('../isPOJO');
=======
>>>>>>> c23b58f (Initial commit or project update)

/*!
 * ignore
 */

module.exports = function isExclusive(projection) {
  if (projection == null) {
    return null;
  }

  const keys = Object.keys(projection);
<<<<<<< HEAD
  let exclude = null;

  if (keys.length === 1 && keys[0] === '_id') {
    exclude = !projection._id;
  } else {
    for (let ki = 0; ki < keys.length; ++ki) {
=======
  let ki = keys.length;
  let exclude = null;

  if (ki === 1 && keys[0] === '_id') {
    exclude = !projection._id;
  } else {
    while (ki--) {
>>>>>>> c23b58f (Initial commit or project update)
      // Does this projection explicitly define inclusion/exclusion?
      // Explicitly avoid `$meta` and `$slice`
      const key = keys[ki];
      if (key !== '_id' && isDefiningProjection(projection[key])) {
<<<<<<< HEAD
        exclude = isPOJO(projection[key]) ?
          (isExclusive(projection[key]) ?? exclude) :
          !projection[key];
        if (exclude != null) {
          break;
        }
=======
        exclude = (projection[key] != null && typeof projection[key] === 'object') ?
          isExclusive(projection[key]) :
          !projection[key];
        break;
>>>>>>> c23b58f (Initial commit or project update)
      }
    }
  }

  return exclude;
};
